!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).clusterfck=e()}}(function(){return function n(o,h,a){function f(s,e){if(!h[s]){if(!o[s]){var t="function"==typeof require&&require;if(!e&&t)return t(s,!0);if(u)return u(s,!0);var i=new Error("Cannot find module '"+s+"'");throw i.code="MODULE_NOT_FOUND",i}var r=h[s]={exports:{}};o[s][0].call(r.exports,function(e){var t=o[s][1][e];return f(t||e)},r,r.exports,n,o,h,a)}return h[s].exports}for(var u="function"==typeof require&&require,e=0;e<a.length;e++)f(a[e]);return f}({1:[function(e,t,s){t.exports={hcluster:e("./hcluster"),Kmeans:e("./kmeans"),kmeans:e("./kmeans").kmeans}},{"./hcluster":3,"./kmeans":4}],2:[function(e,t,s){t.exports={euclidean:function(e,t){for(var s=0,i=0;i<e.length;i++)s+=Math.pow(t[i]-e[i],2);return Math.sqrt(s)},manhattan:function(e,t){for(var s=0,i=0;i<e.length;i++)s+=Math.abs(t[i]-e[i]);return s},max:function(e,t){for(var s=0,i=0;i<e.length;i++)s=Math.max(s,Math.abs(t[i]-e[i]));return s}}},{}],3:[function(e,t,s){var a=e("./distance"),f=function(e,t,s){this.distance=e,this.linkage=t,this.threshold=null==s?1/0:s};f.prototype={tree:function(e,t,s){this.tree=[],this.dists=[],this.mins=[],this.index=[];for(var i=0;i<e.length;i++){var r={value:e[i],key:i,index:i,size:1};this.tree[i]=r,this.index[i]=r,this.dists[i]=[],this.mins[i]=0}for(i=0;i<this.tree.length;i++)for(var n=0;n<=i;n++){var o=i==n?1/0:this.distance(this.tree[i].value,this.tree[n].value);this.dists[i][n]=o,(this.dists[n][i]=o)<this.dists[i][this.mins[i]]&&(this.mins[i]=n)}var h=this.mergeClosest();for(i=0;h;)s&&i++%t==0&&s(this.tree),h=this.mergeClosest();return this.tree.forEach(function(e){delete e.key,delete e.index}),this.tree},mergeClosest:function(){for(var e=0,t=1/0,s=0;s<this.tree.length;s++){var i=this.tree[s].key;(h=this.dists[i][this.mins[i]])<t&&(e=i,t=h)}if(t>=this.threshold)return!1;var r=this.index[e],n=this.index[this.mins[e]],o={dist:t,left:r,right:n,key:r.key,size:r.size+n.size};this.tree[r.index]=o,this.tree.splice(n.index,1),this.index[r.key]=o;for(s=0;s<this.tree.length;s++){var h,a=this.tree[s];r.key==a.key?h=1/0:"single"==this.linkage?(h=this.dists[r.key][a.key],this.dists[r.key][a.key]>this.dists[n.key][a.key]&&(h=this.dists[n.key][a.key])):"complete"==this.linkage?(h=this.dists[r.key][a.key],this.dists[r.key][a.key]<this.dists[n.key][a.key]&&(h=this.dists[n.key][a.key])):h="average"==this.linkage?(this.dists[r.key][a.key]*r.size+this.dists[n.key][a.key]*n.size)/(r.size+n.size):this.distance(a.value,r.value),this.dists[r.key][a.key]=this.dists[a.key][r.key]=h}for(s=0;s<this.tree.length;s++){var f=this.tree[s].key;if(this.mins[f]==r.key||this.mins[f]==n.key){t=f;for(var u=0;u<this.tree.length;u++){var d=this.tree[u].key;this.dists[f][d]<this.dists[f][t]&&(t=d)}this.mins[f]=t}this.tree[s].index=s}return delete r.key,delete n.key,delete r.index,delete n.index,!0},clusters:function(e){(e>this.tree.size||e<1)&&(e=this.tree.size);for(var t=[],s=[this.tree];1<e;){var i=r(s);s.splice(s.indexOf(i),1),s.push(i.left,i.right),e--}function r(e){var t,s=-1;return e.forEach(function(e){e.dist>s&&(s=e.dist,t=e)}),t}return s.forEach(function(e){t.push(function e(t){if(1===t.size)return[t.value];return e(t.left).concat(e(t.right))}(e))}),t}};t.exports=function(e,t,s,i,r,n){s=s||"average","string"==typeof(t=t||"euclidean")&&(t=a[t]);var o=new f(t,s,i),h=o.tree(e,r,n);return{tree:void 0===i?h[0]:h,clusters:o.clusters}}},{"./distance":2}],4:[function(e,t,s){var v=e("./distance");function i(e){this.centroids=e||[]}i.prototype.randomCentroids=function(e,t){var s=e.slice(0);return s.sort(function(){return Math.round(Math.random())-.5}),s.slice(0,t)},i.prototype.classify=function(e,t){var s=1/0,i=0;"string"==typeof(t=t||"euclidean")&&(t=v[t]);for(var r=0;r<this.centroids.length;r++){var n=t(e,this.centroids[r]);n<s&&(s=n,i=r)}return i},i.prototype.cluster=function(e,t,s,i,r){t=t||Math.max(2,Math.ceil(Math.sqrt(e.length/2))),"string"==typeof(s=s||"euclidean")&&(s=v[s]),this.centroids=this.randomCentroids(e,t);for(var n=new Array(e.length),o=new Array(t),h=0,a=!0;a;){for(var f=0;f<e.length;f++)n[f]=this.classify(e[f],s);a=!1;for(var u=0;u<t;u++){var d=[];for(f=0;f<n.length;f++)n[f]==u&&d.push(e[f]);if(d.length){for(var c=this.centroids[u],l=new Array(c.length),y=0;y<c.length;y++){var k=0;for(f=0;f<d.length;f++)k+=d[f][y];l[y]=k/d.length,l[y]!=c[y]&&(a=!0)}this.centroids[u]=l,o[u]=d}}r&&h++%i==0&&r(o)}return o},i.prototype.toJSON=function(){return JSON.stringify(this.centroids)},i.prototype.fromJSON=function(e){return this.centroids=JSON.parse(e),this},t.exports=i,t.exports.kmeans=function(e,t){return(new i).cluster(e,t)}},{"./distance":2}]},{},[1])(1)}),self.onmessage=function(e){var t,s=[],i=new clusterfck.Kmeans(e.data.centroids||[]);try{s=i.cluster(e.data.data,e.data.numClusters||3)}catch(e){t=e.message}s=s.map(function(e){return e.map(function(e){return e.id})}),self.postMessage({clusters:s,error:t})};