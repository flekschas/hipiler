!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.clusterfck=e()}}(function(){return function e(t,s,i){function r(o,h){if(!s[o]){if(!t[o]){var a="function"==typeof require&&require;if(!h&&a)return a(o,!0);if(n)return n(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var u=s[o]={exports:{}};t[o][0].call(u.exports,function(e){var s=t[o][1][e];return r(s||e)},u,u.exports,e,t,s,i)}return s[o].exports}for(var n="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,s){t.exports={hcluster:e("./hcluster"),Kmeans:e("./kmeans"),kmeans:e("./kmeans").kmeans}},{"./hcluster":3,"./kmeans":4}],2:[function(e,t,s){t.exports={euclidean:function(e,t){for(var s=0,i=0;i<e.length;i++)s+=Math.pow(t[i]-e[i],2);return Math.sqrt(s)},manhattan:function(e,t){for(var s=0,i=0;i<e.length;i++)s+=Math.abs(t[i]-e[i]);return s},max:function(e,t){for(var s=0,i=0;i<e.length;i++)s=Math.max(s,Math.abs(t[i]-e[i]));return s}}},{}],3:[function(e,t,s){var i=e("./distance"),r=function(e,t,s){this.distance=e,this.linkage=t,this.threshold=void 0==s?1/0:s};r.prototype={tree:function(e,t,s){this.tree=[],this.dists=[],this.mins=[],this.index=[];for(var i=0;i<e.length;i++){var r={value:e[i],key:i,index:i,size:1};this.tree[i]=r,this.index[i]=r,this.dists[i]=[],this.mins[i]=0}for(var i=0;i<this.tree.length;i++)for(var n=0;n<=i;n++){var o=i==n?1/0:this.distance(this.tree[i].value,this.tree[n].value);this.dists[i][n]=o,this.dists[n][i]=o,o<this.dists[i][this.mins[i]]&&(this.mins[i]=n)}for(var h=this.mergeClosest(),i=0;h;)s&&i++%t==0&&s(this.tree),h=this.mergeClosest();return this.tree.forEach(function(e){delete e.key,delete e.index}),this.tree},mergeClosest:function(){for(var e=0,t=1/0,s=0;s<this.tree.length;s++){var i=this.tree[s].key,r=this.dists[i][this.mins[i]];r<t&&(e=i,t=r)}if(t>=this.threshold)return!1;var n=this.index[e],o=this.index[this.mins[e]],h={dist:t,left:n,right:o,key:n.key,size:n.size+o.size};this.tree[n.index]=h,this.tree.splice(o.index,1),this.index[n.key]=h;for(var s=0;s<this.tree.length;s++){var r,a=this.tree[s];n.key==a.key?r=1/0:"single"==this.linkage?(r=this.dists[n.key][a.key],this.dists[n.key][a.key]>this.dists[o.key][a.key]&&(r=this.dists[o.key][a.key])):"complete"==this.linkage?(r=this.dists[n.key][a.key],this.dists[n.key][a.key]<this.dists[o.key][a.key]&&(r=this.dists[o.key][a.key])):r="average"==this.linkage?(this.dists[n.key][a.key]*n.size+this.dists[o.key][a.key]*o.size)/(n.size+o.size):this.distance(a.value,n.value),this.dists[n.key][a.key]=this.dists[a.key][n.key]=r}for(var s=0;s<this.tree.length;s++){var f=this.tree[s].key;if(this.mins[f]==n.key||this.mins[f]==o.key){for(var t=f,u=0;u<this.tree.length;u++){var d=this.tree[u].key;this.dists[f][d]<this.dists[f][t]&&(t=d)}this.mins[f]=t}this.tree[s].index=s}return delete n.key,delete o.key,delete n.index,delete o.index,!0},clusters:function(e){function t(e){return 1===e.size?[e.value]:t(e.left).concat(t(e.right))}(e>this.tree.size||e<1)&&(e=this.tree.size);for(var s=[],i=[this.tree];e>1;){var r=function(e){var t,s=-1;return e.forEach(function(e){e.dist>s&&(s=e.dist,t=e)}),t}(i);i.splice(i.indexOf(r),1),i.push(r.left,r.right),e--}return i.forEach(function(e){s.push(t(e))}),s}};var n=function(e,t,s,n,o,h){t=t||"euclidean",s=s||"average","string"==typeof t&&(t=i[t]);var a=new r(t,s,n),f=a.tree(e,o,h);return{tree:void 0===n?f[0]:f,clusters:a.clusters}};t.exports=n},{"./distance":2}],4:[function(e,t,s){function i(e){this.centroids=e||[]}var r=e("./distance");i.prototype.randomCentroids=function(e,t){var s=e.slice(0);return s.sort(function(){return Math.round(Math.random())-.5}),s.slice(0,t)},i.prototype.classify=function(e,t){var s=1/0,i=0;"string"==typeof(t=t||"euclidean")&&(t=r[t]);for(var n=0;n<this.centroids.length;n++){var o=t(e,this.centroids[n]);o<s&&(s=o,i=n)}return i},i.prototype.cluster=function(e,t,s,i,n){t=t||Math.max(2,Math.ceil(Math.sqrt(e.length/2))),s=s||"euclidean","string"==typeof s&&(s=r[s]),this.centroids=this.randomCentroids(e,t);for(var o=new Array(e.length),h=new Array(t),a=0,f=!0;f;){for(var u=0;u<e.length;u++)o[u]=this.classify(e[u],s);f=!1;for(var d=0;d<t;d++){for(var c=[],u=0;u<o.length;u++)o[u]==d&&c.push(e[u]);if(c.length){for(var l=this.centroids[d],y=new Array(l.length),v=0;v<l.length;v++){for(var k=0,u=0;u<c.length;u++)k+=c[u][v];y[v]=k/c.length,y[v]!=l[v]&&(f=!0)}this.centroids[d]=y,h[d]=c}}n&&a++%i==0&&n(h)}return h},i.prototype.toJSON=function(){return JSON.stringify(this.centroids)},i.prototype.fromJSON=function(e){return this.centroids=JSON.parse(e),this},t.exports=i,t.exports.kmeans=function(e,t){return(new i).cluster(e,t)}},{"./distance":2}]},{},[1])(1)}),self.onmessage=function(e){var t,s=[],i=new clusterfck.Kmeans(e.data.centroids||[]);try{s=i.cluster(e.data.data,e.data.numClusters||3)}catch(e){t=e.message}s=s.map(function(e){return e.map(function(e){return e.id})}),self.postMessage({clusters:s,error:t})};