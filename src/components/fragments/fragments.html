<template>
  <require from="components/multi-select/multi-select"></require>
  <require from="components/spinner.html"></require>
  <require from="components/svg-icon.html"></require>

  <div class="flex-c flex-a-c flex-jc-c full-dim error-indicator ${isErrored ? 'is-active' : ''}">
    <div class="flex-c flex-d-c flex-jc-c flex-a-c">
      <svg-icon icon-id="warning"></svg-icon>
      <span>${errorMsg}</span>
    </div>
  </div>
  <div class="flex-c flex-a-c flex-jc-c full-dim loading-indicator ${isLoading ? 'is-active' : ''}">
    <spinner if.bind="isLoading"></spinner>
  </div>

  <div class="full-wh flex-c flex-d-c ${fgmState.animation ? 'is-animated' : ''}" ref="baseEl">
    <main class="flex-g-1 rel fragment-plot">
      <div class="full-dim" background-color="yellow" ref="plotEl"></div>
    </main>
    <footer class="flex-c bottom-bar ${footerIsExpanded ? 'is-expanded' : ''}">
      <ul class="flex-c flex-i-1 settings-list">
        <li class="flex-c flex-d-c">
          <label for="settings-fgm-size">Fragment Size</label>
          <input
            id="settings-fgm-size"
            type="range"
            min="1"
            max="10"
            step="1"
            value.one-way="cellSize"
            change.delegate="cellSizeChangedHandler($event)">
        </li>
        <li class="flex-c flex-d-c">
          <label
            for="settings-fgm-show-low-quality"
            title="Show low quality cells">Low Qual.</label>
          <input
            type="checkbox"
            id="settings-fgm-show-low-quality"
            checked.bind="fgmState.showSpecialCells"
            click.delegate="showSpecialCellsChangeHandler()">
        </li>
        <li class="flex-c flex-d-c">
          <label for="settings-fgm-animate">Animate</label>
          <input
            type="checkbox"
            id="settings-fgm-animate"
            checked.bind="fgmState.animation"
            click.delegate="animationChangeHandler()">
        </li>
        <li class="flex-c flex-d-c">
          <label for="settings-fgm-cover">Cover Mode</label>
          <select
            id="settings-fgm-cover"
            change.delegate="coverDispModeChangeHandler($event)">
            <option
              repeat.for="option of coverDispModes"
              value.one-way="option.id"
              selected.bind="option.id === coverDispMode">${option.name}</option>
          </select>
        </li>
        <li class="flex-c flex-d-c">
          <label for="settings-fgm-order-cluster">Arrange X</label>
          <div class="flex-c">
            <select
              id="settings-fgm-cover"
              change.delegate="arrangeXChangeHandler($event)">
              <option value="">Choose…</option>
              <option
                repeat.for="metric of metrics"
                value.one-way="metric.id">${metric.name}</option>
            </select>
            <input
              type="checkbox"
              checked.bind="fgmState.arrangeXDesc"
              click.delegate="arrangeXDescChangeHandler()">
          </div>
        </li>
        <li class="flex-c flex-d-c">
          <label for="settings-fgm-order-cluster">Arrange Y</label>
          <div class="flex-c">
            <select
              id="settings-fgm-cover"
              change.delegate="arrangeYChangeHandler($event)">
              <option value="">Choose…</option>
              <option
                repeat.for="metric of metrics"
                value.one-way="metric.id">${metric.name}</option>
            </select>
            <input
              type="checkbox"
              checked.bind="fgmState.arrangeYDesc"
              click.delegate="arrangeYDescChangeHandler()">
          </div>
        </li>
        <li class="flex-c flex-d-c">
          <label for="settings-fgm-order-cluster">Cluster</label>
          <multi-select
            bottom-up="true"
            options.bind="metrics"
            event-id.bind="arrangeSelectedEventId"
            placeholder="Choose…"></multi-select>
        </li>
<!--         <li class="flex-c flex-d-c">
          <label for="settings-fgm-is-fixed-cat-colors">Fix Colors</label>
          <input type="checkbox" id="settings-fgm-is-fixed-cat-colors">
        </li> -->
      </ul>
      <button
        class="toggler ${footerIsExpanded ? 'is-active' : ''}"
        click.delegate="footerToggle()">
        ${footerIsExpanded ? 'Less' : 'More'}
      </button>
    </footer>
  </div>

  <script type="x-shader/x-vertex" id="shader-vertex">
     attribute vec3 customColor;
     varying vec3 vColor;
     void main() {
        vColor = customColor;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
     }
  </script>

  <script type="x-shader/x-fragment" id="shader-fragment">
     varying vec3 vColor;
     void main() {
       gl_FragColor = vec4( vColor, 1);
     }
  </script>
</template>
